<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[☺分类☺：技术 | 刘江华的博客]]></title>
  <link href="http://yanyaner.com/blog/categories/ji-zhu/atom.xml" rel="self"/>
  <link href="http://yanyaner.com/"/>
  <updated>2013-12-23T17:51:45+08:00</updated>
  <id>http://yanyaner.com/</id>
  <author>
    <name><![CDATA[冰雨]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[在项目中使用maven之一--环境配置]]></title>
    <link href="http://yanyaner.com/blog/2013/12/23/maven/"/>
    <updated>2013-12-23T15:18:00+08:00</updated>
    <id>http://yanyaner.com/blog/2013/12/23/maven</id>
    <content type="html"><![CDATA[<p>&emsp;&emsp;Apache Maven是一个软件项目综合管理工具，它基于项目对象模型（POM）的概念来统一管理项目，使用Maven可以更好地管理项目的模块化，更好地管理项目之间的依赖，更好地管理jar包依赖及其版本，也更加贴近项目管理的各个阶段。</p>

<p>&emsp;&emsp;你是否碰到过这样的一些困扰，比如：你现在要搭建一个现今比较流行的SSH javaEE框架原型，按照传统的方式，你得把项目所依赖的第三方框架jar包拷贝到工程的lib目录下再进行整合，但是，在你的架构原型中，每一个框架要用什么版本，各个版本的jar包之间是否会有不兼容的情况？这些都会给整个过程带来麻烦，并花费大量的调试时间。</p>

<p>&emsp;&emsp;如果有了Maven，这个事情会变得简单，你也许只需要声明一个依赖关系，所有的一切都自动完成了。</p>

<p>&emsp;&emsp;例如，我要写一个activeMQ的JMS项目，我的pom.xml中，只要添加如下的一个依赖，即可开始编码了：</p>

<p>``` xml pom.xml
<dependencies></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
    &lt;artifactId&gt;activemq-core&lt;/artifactId&gt;
    &lt;version&gt;5.7.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>  </dependencies>
```</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2013/12/maven1.jpg' width='' height='' title='activeMQ项目中maven依赖的项目包'><span class='caption-text'>activeMQ项目中maven依赖的项目包</span></span></p>

<p>&emsp;&emsp;当然，上面的示例中使用maven也有一点约束，那就是你的开发机器必须要能够连接到互联网上，并且网速不能太卡（这点可能有些开发者的环境无法满足而制约了maven在国内的普及速度），原因显而易见：所有的jar包需要从网上的仓库中下载到本地。<!--more--></p>

<p>&emsp;&emsp;你可能通过上面的那段配置文件已经发现，在maven中世界中，每一个你所依赖的组件都是通过groupId、artifactId、version三个字段来定位的，好比x、y、h可以定位一个三维空间中的目标一样。如果你要问，我怎么知道所依赖的包的三维坐标信息呢，答案是：到<a href="http://mvnrepository.com/">mvnrepository.com</a>上查询。</p>

<p>&emsp;&emsp;如果公司的开发环境处在一个封闭的局域网内，就得需要安装一些工具，另加一些额外的配置了，nexus是值得选择的内网Maven仓库，下面我给大家简单介绍一下nexus的安装、配置以及maven的基本配置。</p>

<p>&emsp;&emsp;步骤如下：
&ndash; 到nexus官网，下载nexus-2.7.0-04-bundle.zip文件（当然，你下载的版本号可能和我不同）
&ndash; 解压到自已的一个目录中，比如我放到了D:\dev_tools\nexus-2.7.0-04-bundle\下
&ndash; 接着，添加到路径变量到path中，注意是bin目录，我添加的是D:\dev_tools\nexus-2.7.0-04-bundle\nexus-2.7.0-04\bin
&ndash; 安装系统服务，进入cmd中，运行：nexus install，这个时候，你可以在window的系统服务中看到这样的路径信息：D:\dev_tools\nexus-2.7.0-04-bundle\nexus-2.7.0-04\bin\jsw\windows-x86-32\wrapper.exe -s D:\dev_tools\nexus-2.7.0-04-bundle\nexus-2.7.0-04\bin\jsw\conf\wrapper.conf,实际运行的就是这个命令
&ndash; 启动服务：nexus start，如果不出意外的话，你可以看到下面的界面，这证明安装成功了，。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2013/12/nexus1.jpg' width='' height='' title='启动nexus cmd界面'><span class='caption-text'>启动nexus cmd界面</span></span></p>

<p>&emsp;&emsp;在浏览器中，输入 htt p:/ / localhost:8081/nexus/  ，在主页面中输入用户名admin，密码admin123即可完成登录。</p>

<p>&emsp;&emsp;在Repositories中建立自己的仓库，如下图表中的Car ManagerSystem Release、Car ManagerSystem Snapshots就是我为车辆租赁管理系统建立的Release及Snapshort版本（这里注意，一般Repository ID有多个单词的情况下用-连接，我当时的命名并不规范）。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2013/12/nexus2.jpg' width='' height='' title='我的项目中nexus截图'><span class='caption-text'>我的项目中nexus截图</span></span></p>

<p>&emsp;&emsp;接下来，找到Security菜单项，针对新建的两个仓库分别配置Privileges,Roles,Users。关于nexus的详细教程，大家可以自行在网上搜索，我在这还再详述。</p>

<p>&emsp;&emsp;下面要安装MAVEN了，步骤如下：</p>

<ul>
<li>到官网上下载apache-maven-3.1.1-bin.zip（你的版本可能跟我不一样），解压到目录D:\dev_tools\maven-3.1.1下（这个目录大家自行决定）。</li>
<li>在环境变量中，将maven的bin目录加入到path中。</li>
</ul>


<p>&emsp;&emsp;回到命令行下，输入mvn，出现下面界面，说明maven安装成功（当然，添加环境变量，只是为了你可以在命令行手工运行maven）。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2013/12/maven2.jpg' width='' height='' title='安装成功的cmd窗口'><span class='caption-text'>安装成功的cmd窗口</span></span></p>

<p>&emsp;&emsp;目前的新版eclipse集成了maven，一般建议大家使用本地安装的maven以达到版本的统一，你可以在eclipse中进行选择配置，界面如下：</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2013/12/maven3.jpg' width='' height='' title='在eclipse中配置非集成maven'><span class='caption-text'>在eclipse中配置非集成maven</span></span></p>

<p>&emsp;&emsp;接下来，我们对maven进行参数进行配置，一般配置文件位于C:\Documents and Settings\Administrator.m2下，文件名为settings.xml，下面是我节选的部分修改过的配置代码：</p>

<p>``` xml settings.xml</p>

<pre><code> &lt;localRepository&gt;F:/java/maven&lt;/localRepository&gt;
</code></pre>

<p><servers></p>

<pre><code> &lt;server&gt;
  &lt;id&gt;carManagerProjectRelease&lt;/id&gt;
  &lt;username&gt;deployment&lt;/username&gt;
  &lt;password&gt;deployment123&lt;/password&gt;
&lt;/server&gt;

&lt;server&gt;
  &lt;id&gt;carManagerProjectSnapshot&lt;/id&gt;
  &lt;username&gt;deployment&lt;/username&gt;
  &lt;password&gt;deployment123&lt;/password&gt;
&lt;/server&gt;
</code></pre>

<p></servers></p>

<pre><code>&lt;profiles&gt;
   &lt;profile&gt;
   &lt;id&gt;central-repos&lt;/id&gt;
   &lt;repositories&gt;
        &lt;repository&gt;
          &lt;id&gt;central&lt;/id&gt;
          &lt;name&gt;Central&lt;/name&gt;
          &lt;url&gt;http://127.0.0.1:8081/nexus/content/groups/public/&lt;/url&gt;
          &lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
          &lt;/snapshots&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;

&lt;activeProfiles&gt;
    &lt;activeProfile&gt;central-repos&lt;/activeProfile&gt;
&lt;/activeProfiles&gt;
</code></pre>

<p>```</p>

<p>&emsp;&emsp;上面的文件中，我主要配置了本地仓库所在的位置，maven从网上下载的第三方依赖包，都将存放在这个地方。我放到了F:/java/maven，如果你的这个目录下已经有了非常多的jar包，你可以将这个目录直接copy给其它的开发同事机器上，避免重复下载。</p>

<p>&emsp;&emsp;server部分配置了可以上传到nexus中的相关账户的登录名及密码，这些信息都是在nexus的管理界面中配置的。而http : / /127.0.0.1:8081/nexus/content/groups/public 则是本地maven库所在的服务器路径。</p>

<p>&emsp;&emsp;好了，今天先到这，下一篇文章会详细介绍如何在项目中使用maven.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[万恶的u盘启动程序]]></title>
    <link href="http://yanyaner.com/blog/2013/12/05/udisk/"/>
    <updated>2013-12-05T15:18:00+08:00</updated>
    <id>http://yanyaner.com/blog/2013/12/05/udisk</id>
    <content type="html"><![CDATA[<p>&emsp;&emsp;前两天给一邻居家安装操作系统，由于他家的电脑没有光驱，只好自己做一个启动U盘。</p>

<p>&emsp;&emsp;网上搜索了一下U盘启动盘制作程序，进入排名首位的站点是：www.uqidong.com ，名字就叫“U启动”，原来有专门做这个的网站，看来还真够专业的，不得暗暗佩服！</p>

<p>&emsp;&emsp;马上download这个程序，居然有300多M，这是一个什么样的功能强大的程序呢？我记得以前下载的U盘启动盘制作程序，也就只有区区1~2M就搞定了啊。好不容易下载完成，点击安装，一路下一步，下一步直至完成，还算顺利。</p>

<p>&emsp;&emsp;当我回到桌面一看，吃了一惊，冒出来好多个快捷网址链接，都是一些不相关的网站，并且还默默地在后台安装了一个新的浏览器，原来，www.uqidong.com 上的东西，是一个垃圾软件，流氓软件。</p>

<p>&emsp;&emsp;启动软件，开始启动盘的制作，发现制作速度非常慢，其中，有些选项会提示将hao123设置为主页，真是垃圾中的垃圾，一个小小的启动盘制作软件，居然捆绑了这么多的无关软件和设置项在里面。</p>

<p>&emsp;&emsp;这还没算完。我随后发现，IE，360浏览器，火狐浏览器的主页，全部被修改成了260260.com，并且访问localhost本地路径，也会跳转到260260.com，而260260.com则会跳转到hao123.com，随即，我将所有的浏览器主页恢复成原来的页面。</p>

<p>&emsp;&emsp;紧接着，用360卫士进行插件扫描，发现又多扫描出4个广告相关插件，随即重新启动电脑。</p>

<p>&emsp;&emsp;电脑重启后，我以为已经清除干净，但一访问本地localhost，又转到了hao123导航，看来，还有残余存在。我进入注册表编辑器，搜索所有的260260.com,hao123.com相关的项，全部删除，但问题依旧。</p>

<p>&emsp;&emsp;后来，找到windows/system32/etc/host文件，打开一看，吓了一跳，里面被改得面目全非，添加了几十个localhost的网址映射，260260.com也在里面，我一个个删除，保存，问题依旧。</p>

<p>&emsp;&emsp;再次打开host文件，发现刚才删除的内容，又被写回，只有再次删除，并将文件设置为只读，host文件的写入才被禁止，这真是一个病毒程序，如此之顽固。</p>

<p>&emsp;&emsp;再访问本地localhost，又转到了hao123导航，还是老样子啊。这才发现，原来程序在本机安装了一个apache服务器，并且集成了php环境，我通过httpd.conf找到它的web目录，在index.php文件中，终于看到了源代码：<!--more--></p>

<p>``` php
&lt;?php<br/>
  $name1 = &ldquo;www.2345.com,2345.com,www.tao123.com,tao123.com&rdquo;;
  $name2 = &ldquo;www.xp519.com,xp519.com,www.xitongzhijia.net,xitongzhijia.net,www.386w.com,386w.com,www.xitong8.com,xitong8.com,www.hyghost.com,hyghost.com,moguxz.com,www.moguxz.com,www.xpxtzj.com,xpxtzj.com&rdquo;;
  $name3 = &ldquo;www.22mm.cc,www.mnsfz.com,www.4493.com,www.7160.com,www.youzi4.com,www.juemei.cc,www.mm131com,www.xiaojiuwo.com,www.tpdq.net,www.920mm.com,www.169pp.com,www.xgmm.cc,www.kmeitu.com,www.qq360x.com,www.123kmm.com,www.09218.com,www.mm3.cc,www.b4mm.com,www.tuku.com,www.xiaomm.cc,www.84420.com,www.gunianger.com,www.ii6i.com,www.mmkaixin.com,www.06324.com,www.6188.net,www.8mei.cc,www.mzitu.com,www.mmlin.com,www.mm588.com,www.meiniu.cc,www.t8a8.com,www.99521.com,www.kmeitu.com,www.909mm.com,www.169meitu.com,www.xiezhenku.com,www.yangyanmm.com,22mm.cc,mnsfz.com,4493.com,7160.com,youzi4.com,juemei.cc,mm131com,xiaojiuwo.com,tpdq.net,920mm.com,169pp.com,xgmm.cc,kmeitu.com,qq360x.com,123kmm.com,09218.com,mm3.cc,b4mm.com,tuku.com,xiaomm.cc,84420.com,gunianger.com,ii6i.com,mmkaixin.com,06324.com,6188.net,8mei.cc,mzitu.com,mmlin.com,mm588.com,meiniu.cc,t8a8.com,99521.com,kmeitu.com,909mm.com,169meitu.com,xiezhenku.com,yangyanmm.com,p.39yst.com,pic.39yst.com,tu.dddddd.net,tu.5239.com,pic.qm120.com,tuku.0789.net,meinv.nvxingku.com,tuku.meinv.com,tuku.0789.net,meinv.xinggan.com,tuku.piaoliang.com,mm.raorao.com,tuku.guimi.com&rdquo;;</p>

<p>  $name1_404 = &ldquo;<a href="http://www.260260.com/?4">http://www.260260.com/?4</a>&rdquo;;
  $name2_404 = &ldquo;<a href="http://www.xpxtw.com/?4">http://www.xpxtw.com/?4</a>&rdquo;;
  $name3_404 = &ldquo;<a href="http://www.xgxz.com/?4">http://www.xgxz.com/?4</a>&rdquo;;
  $default_404 = &ldquo;<a href="http://www.260260.com/?4">http://www.260260.com/?4</a>&rdquo;;</p>

<p>  $server_name = $_SERVER[&ldquo;HTTP_HOST&rdquo;];
   switch($server_name){</p>

<pre><code>case strpos($name1,$server_name)!==false:
    header("Location:$name1_404");
    break;
   case strpos($name2,$server_name)!==false:
    header("Location:$name2_404");
    break;
case strpos($name3,$server_name)!==false:
    header("Location:$name3_404");
    break;
default:
    header("Location:$default_404");
        break;
} 
    ?&gt;&lt;meta http-equiv="refresh" content="0;url=http://www.260260.com/?301"&gt;
</code></pre>

<p>```</p>

<p>&emsp;&emsp;源码中可以发现很多的无关网址，并且首页还通过refresh自动跳到260260上去，真的很无耻。</p>

<p>&emsp;&emsp;停止这个apache服务（它已经做成了自启动），并删除服务器目录，问题得到解决。</p>

<p>&emsp;&emsp;更可怕的是，在网上搜到的U盘启动盘制作软件，大部分都是这个300多M的程序，看来，这个病毒式的流氓程序，会在更多人的电脑中流行起来，还我，我们是懂一点计算机程序的专业人士，可以手工清楚这个程序，要是普通的电脑盲的话，将根本找不到问题的症结所在，也就只有默默忍受这一切。而写这个程序的团队，将会从中获益。</p>

<p>&emsp;&emsp;希望看到此文的人，多转发转发，以免更多人上当。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的独立博客再次开放]]></title>
    <link href="http://yanyaner.com/blog/2013/11/26/my-blog/"/>
    <updated>2013-11-26T15:18:00+08:00</updated>
    <id>http://yanyaner.com/blog/2013/11/26/my-blog</id>
    <content type="html"><![CDATA[<p>&emsp;&emsp;有一天，突然看到山子在群里发了他的个人博客地址，感觉还不错，就多问了几句：</p>

<p>```</p>

<pre><code>冰雨 9:14:05 
山子，你的github博客，是怎么搭建的呢
冰雨 9:14:11 
搞得非常不错呢
李山 9:14:49 
就是自己做的静态页面，传到gitHub上了，gitHub  pages可以解析页面的
冰雨 9:15:11 
它支持什么？
冰雨 9:15:18 
html,php?
冰雨 9:15:22 
jsp支持否？
冰雨 9:15:26 
mysql呢？
李山 9:15:36 
只支持静态的页面
冰雨 9:16:02 
你的博客的页面，都是静态的？没有数据库？
李山 9:16:49 
没有的啊
冰雨 9:17:23 
那就是存手工操作，在本地编辑好，发布上去。
冰雨 9:17:32 
它的空间，最大是多少呢？
冰雨 9:17:49 
也没看到有广告，难道是存免费的？
李山 9:17:55 
空间不限制的
李山 9:18:20 
github就是免费的啊，可以随便整
冰雨 9:19:12 
我在博客上给你留言,是保存不上的吧？
李山 9:19:24 
保存的
李山 9:19:49 
评论是用的其他的插件
冰雨 9:20:01 
哦。存在哪的？ 
李山 9:20:48 
这个我是用的多说的插件，是存在多说的服务器上的
李山 9:21:00 
这个插件有好多的
冰雨 9:21:09 
哦，我看到了的。
冰雨 9:21:27 
那你本地，是用git上传的吧
李山 9:21:47 
嗯，做好页面直接传到gitHub上就行了
冰雨 9:23:20 
哦，那还不错
李山 9:24:26 
刘老，你也做一个啊
冰雨 9:26:04 
你的网页模板，用的是那个呢？
冰雨 9:26:27 
应该在本地安装一个cms，然后生成html ,再传上去
冰雨 9:26:33 
这样，是不是更好一些？
李山 9:27:31 
不用的，gitHub支持jekyll模版，可以用markdown做页面传上去后可以自动解析
冰雨 9:29:56 
哦，这么复杂
冰雨 9:30:05 
看来，要向你多学习才是
</code></pre>

<p>```
&emsp;&emsp;我以前的个人博客，是搭建在linode VPS上的，但因为后来的一些原因没再续费，博客也就停了。</p>

<p>&emsp;&emsp;再后来，我的博客都放在了百度空间上，虽然百度空间各种体验都很差，但也只好将就着，忍着。</p>

<p>&emsp;&emsp;当我从山子那了解到github上可以免费托管博客，在网上搜了一下，立即搭建了本地环境（说实话，在windows下搭建octopress还真麻烦，各种出错，还好，都一一解决了），将百度空间上的文章全部转到了新的博客系统上。</p>

<p>&emsp;&emsp;转载几年前的老文章时才发现，近年来写的博客越来越少，而且含金量也越来越低。近期的博客更多的是关注代码、技术，而几年前的更加关注的是项目管理、架构。看来今后还得继续发表些高质量的东西，呵呵。</p>

<p>&emsp;&emsp;学习，生活，工作，是人生的组成部分，哪一部分做不好，人生都将存在遗憾。这个新的博客也将记录更多给与工作、技术无关的内容，更多个人生活的内容。</p>

<p>&emsp;&emsp;最后，欢迎各位，有空多来<a href="http://yanyaner.com">yanyaner.com</a>上看看，发现对你有帮助的东西，也希望多多交流。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[一步步教你用angular.js实现一个基本应用---第五部分]]></title>
    <link href="http://yanyaner.com/blog/2013/09/28/angular-js5/"/>
    <updated>2013-09-28T15:18:00+08:00</updated>
    <id>http://yanyaner.com/blog/2013/09/28/angular-js5</id>
    <content type="html"><![CDATA[<p>&emsp;&emsp;我们再来看页面中的标签。</p>

<p>&emsp;&emsp;首页，<strong>index.html</strong>,在这个页面中，我们：</p>

<p>&emsp;&emsp;1、使用ng-app来指明，整个页面使用的model名称。</p>

<p>&emsp;&emsp;2、ng-view标签，指名所有子页面加载显示的位置。</p>

<p>&emsp;&emsp;3、最后引入我们需要的js文件，大家要注意依赖关系。（jquery-1.7.2.min.js不是必须的，因为angular也可以完成dom操作，只不过书写起来没有jquery简洁）</p>

<!--more-->


<p>``` html index.html</p>

<p>&lt;!DOCTYPE html>
<html ng-app="myApp">
<head></p>

<pre><code>&lt;title&gt;&lt;/title&gt;
&lt;link rel="stylesheet" href="http://yanyaner.com/css/bootstrap.min.css"&gt;
&lt;link rel="stylesheet" href="http://yanyaner.com/css/my.css"&gt;
</code></pre>

<p></head>
<body></p>

<pre><code> &lt;div ng-view&gt;&lt;/div&gt;
</code></pre>

<p></body></p>

<script src="js/lib/jquery/jquery-1.7.2.min.js"></script>


<script src="js/commons.js"  ></script>


<script src="js/lib/angular/angular.js"></script>


<script src="js/services.js"></script>


<script src="js/controllers.js"></script>


<script src="js/app.js"></script>


<p></html>
```</p>

<p>&emsp;&emsp;<strong>main.html</strong>，也是用户列表页面：</p>

<p>``` html main.html</p>

<div class="container" ng-init="getState();pageFun(userService.pno);">
    <div id="welcome"><h3>欢迎<span id="who"></span>登录成功！<span><a href="#" ng-click="logout()">退出系统</a></span></h3></div>
    <div class="row"><span>用户名称：</span><input type="text"  ng-model="userService.q_name" class="input-medium search-query">
        <button id="btn_query" class="btn" ng-click="pageFun(1)">搜索</button>
    </div>
    <div style="margin-top: 15px;" class="row"><a  ng-href="/to_adduser"  class="btn">新增</a>
        <a class="btn" ng-click="deleteUsers()">批量删除</a></div>
    <div class="row">
        <div class="span12">
            <table class="table">
                <tr>
                    <th>选择</th>
                    <th>用户id</th>
                    <th>登录名</th>
                    <th>姓名</th>
                    <th>出生日期</th>
                    <th>操作</th>
                </tr>
                <tbody id="users">
                <tr ng-repeat="user in users">
                    <td><input value="" class="uid_c" type="checkbox"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="row_op">
                        <a href="user/">查看</a>
                        <a href="to_modifyuser/">修改</a>
                        <a href="#" ng-click="deleteUser(user._id)">删除</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div style="margin-top: 15px;" class="row">
        <div id="page_info" class="span4">/  共条记录</div>
        <div class="span5 page offset3">
            <a  ng-click="pageFun(page.f_no)" >首 页</a>
            <a  ng-click="pageFun(page.p_no)">上一页</a>
            <a  ng-click="pageFun(page.n_no)">下一页</a>
            <a  ng-click="pageFun(page.l_no)">末 页</a>
        </div>
    </div>
</div>


<p>```
&emsp;&emsp;在主页面中，分页、查询、新增、删除操作的事件，是通过ng-click进行绑定的。</p>

<p>&emsp;&emsp;再来看看具体的CRUD子页面：</p>

<p>&emsp;&emsp;<strong>add_user.html</strong>,添加用户页面</p>

<p>``` html add_user.html</p>

<div class="container" style="margin-top: 20px;" >
    <div>登录编码：<input type="text" ng-model="user.loginCode"></div>
    <div>登录姓名：<input type="text" ng-model="user.name"></div>
    <div>登录密码：<input type="text" ng-model="user.password"></div>
    <div>出生日期：<input type="text" ng-model="user.birthday"></div>
    <input type="hidden" ng-model="user.pic"  id="picPath"/>
    <div class="alert ">
        照片：
        <form action="../commons/upload"
              method="post"
              enctype="multipart/form-data"
              id="uploadForm" target="other_frame">
            <input type='file' name="photo"/>
            <input type='submit' value="上传" class="btn-large btn-primary"/>
            <input type='hidden' name='cbName' value='parent.showImage'/>
        </form>
        <br/>
        <img src="" id="pic"></div>
    <iframe name="other_frame" style='display: none;' ></iframe>
    <div>
        <input type="button" value="新增"  class="btn" ng-click="addUser()"/>
        <input type="button" value="返回"  class="btn" ng-click="back()"/>
    </div>
</div>


<p>```</p>

<p>&emsp;&emsp;<strong>modify_user.html</strong>，修改用户页面。</p>

<p>``` html modify_user.html</p>

<div class="container" ng-init="loadUser();">
    <div class="alert alert-info">用户名称：<input type="text" ng-model="user.userName"/></div>
    <div class="alert alert-success">出生日期：<input type="text" ng-model="user.birthDay" value=""/></div>
    <div class="alert alert-info">登录密码：<input type="password" ng-model="user.password"  placeholder="***"/></div>
    <div class="alert ">  <input type="hidden" ng-model="user.picPath" value="" id="picPath"/>
        照片：
        <form action="../commons/upload"
                                 method="post"
                                 enctype="multipart/form-data"
                                 id="uploadForm" target="other_frame">
            <input type='file' name="photo"/>
            <input type='submit' value="上传" class="btn-large btn-primary"/>
            <input type='hidden' name='cbName' value='parent.showImage'/>
        </form>
        <br/>
     <img id="pic" src="../"/></div>
    <iframe name="other_frame" style='display: none;' ></iframe>
    <div>
        <input type="button" value="修改" class="btn" ng-click="updateUser()"/>
        <input type="button" value="返回" class="btn" ng-click="back()" />
    </div>
</div>


<p>```</p>

<p>&emsp;&emsp;查看用户页面，<strong>view_user.html</strong></p>

<p>``` html view_user.html
 <div class="container"  ng-init="loadUser();"></p>

<pre><code>&lt;div class="alert alert-info"&gt;id：&lt;span id="userId"&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div class="alert alert-success"&gt;用户名称：&lt;span id="userName"&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div class="alert "&gt;照片：&lt;img src="../" &gt;&lt;/div&gt;
&lt;div&gt;&lt;input type="button" value="返回" class="btn btn-large" ng-click="back();"/&gt;&lt;/div&gt;
</code></pre>

<p></div>
```</p>

<p>&emsp;&emsp;最后是登录页面，<strong>login.html</strong></p>

<p>``` html login.html</p>

<div class="container">
    <label>用户名2：</label><input name="uname" type="text" ng-model="user.uname"   class="input-xlarge"><br/>
    <label>密码：</label><input   name="pwd" type="password" ng-model="user.pwd" class="input-xlarge"><br/>
    <input type="button" value="登录系统" id="btn_login" class="btn" ng-click="login()">
</div>


<p>```</p>

<p>&emsp;&emsp;angular.js的入门使用简单介绍到这，随着后期的深入，我会再写一些关于这方面的文章，尽请期待。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[一步步教你用angular.js实现一个基本应用---第四部分]]></title>
    <link href="http://yanyaner.com/blog/2013/09/28/angular-js4/"/>
    <updated>2013-09-28T15:18:00+08:00</updated>
    <id>http://yanyaner.com/blog/2013/09/28/angular-js4</id>
    <content type="html"><![CDATA[<p>&emsp;&emsp;控制器中的代码：</p>

<p>&emsp;&emsp;我一共写了两个控制器，一个是和用户相关的，另一个是登录控制器。</p>

<p>&emsp;&emsp;其中，在页面切换时，需要保存的变量，放到了userService中，因为service是单例的。</p>

<!--more-->


<p>``` js controllers.js</p>

<p>&lsquo;use strict&rsquo;;</p>

<p>/<em> Controllers </em>/</p>

<p>/<em> 用户CRUD相关控制器 </em>/
function userCtrl($rootScope, $scope, $http, $routeParams, $window, $location, $route , userService) {</p>

<p>   $scope.userService = userService;</p>

<p>   $scope.logout = function() {</p>

<pre><code>   window.location.href="/logout";
</code></pre>

<p>   }</p>

<p>   $scope.loadUser = function() {</p>

<pre><code>   $http.get('../main/user/' + $routeParams.uid)
       .success(function(data){
           if (data.code == 0) {
               alert('查询用户失败，原因：' + data.msg);
           } else {
               $scope.user = data.data;
           }
       }) ;
</code></pre>

<p>   }</p>

<pre><code>$scope.deleteUsers=function(){
    var selectedUser = angular.element(".uid_c:checked");
    if (selectedUser.size() == 0) {
        alert("请选择要删除的用户!");
    } else {
        if (confirm("您确定要删除所选择的用户数据吗?")) {
            var ids = "";
            selectedUser.each(function(i){
                if (i == 0) {
                    ids = angular.element(this).val();  //此处或者 this.value也可
                } else {
                    ids = ids + "-" + angular.element(this).val();
                }
            });
            $http.delete("../main/users/" + ids)
                .success(function(result) {
                    alert(result.msg);
                    if (result.code == 1) {
                        $route.reload();
                    }
                }) ;
        }
    }
}

$scope.deleteUser=function(uid){
    if (window.confirm('您确定要删除所选择的记录吗？'))  {
        $http.delete("../main/user/" + uid)
            .success(function(result) {
                alert(result.msg);
                if (result.code == 1) {
                    $route.reload();
                }
            }) ;
    }
}

$scope.addUser = function(){
    $scope.user.pic = angular.element("#picPath").val();
    $http.post("../main/user", $scope.user )
        .success(function(result){
            if (result.code == 1) {
                alert("添加用户成功！");
                $location.url('/user_list');
            } else {
                alert(result.msg);
            }
        });
}

$scope.updateUser = function(){
    //后台需要参数有可能和前台不一致，就需要大家重新构建参数 ,添加请求参数
    $scope.user.pic = angular.element("#picPath").val();
    $scope.user.birthday = $scope.user.birthDay;
    $http.put("../main/user/" + $scope.user._id , $scope.user )
        .success(function(result){
            if (result.code == 1) {
                alert("修改成功！");
                $location.url('/user_list');
            } else {
                alert(result.msg);
            }
    });
}

$scope.pageFun = function(pno) {
    $http.get('main/users/' +  pno ,{params:{q_name:userService.q_name}})
        .success(function(data){
            if (data.code == 0) {
                alert('取用户分页数据失败，原因：' + data.msg);
            } else {
                userService.pno = data.page.pno;
                $scope.page = data.page;
                $scope.users = data.page.data;
            }
        }) ;
};
//$scope.pageFun(1);     //可以通过这种方式加载，但最好用ng-init进行首次加载
$scope.getState = function() {
    if ($rootScope.loginName) {
        //已经执行过getState，不用反复取用户状态
        return;
    }
    $http.get('getState')
        .success(function(data){
            if (data.code == 1) {
                $rootScope.loginName = data.name;
            } else {
                $location.url('/');
            }
        }) ;
}

$scope.back = function(){
    //$window.history.back();
    $location.url('/user_list');
}
$scope.test = function() {
    alert("test:" + $rootScope.allreadyGetState);
}
</code></pre>

<p>}</p>

<p>/<em> 登录系统控制器 </em>/
function loginCtrl($rootScope, $scope, $http, $location) {</p>

<pre><code>   var User = {uname:"0011",pwd:"123"} ;
   //var User = {uname:"",pwd:""} ;
   $scope.user = User;
   $scope.login = function() {
       $http.get('/login',{params:User})
           .success(function(data){
               if (data.code == 0) {
                   alert('登录失败，原因：' + data.msg);
               } else {
                   alert(data.name + '登录成功！');
                   $rootScope.isLogined = true;
                   $location.url('/user_list');
               }
           }) ;
   }
</code></pre>

<p>}</p>

<p>```</p>
]]></content>
  </entry>
  
</feed>
