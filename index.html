
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>刘江华的博客</title>
  <meta name="author" content="冰雨">

  
  <meta name="description" content="&emsp;&emsp;我在《服务器端无状态参数验证实现）》中给大家贴出了无状态调用中对数据的验证机制服务器端实现代码，那么，客户端如何去进行调用呢？我同样给大家给出一个客户端调用的登录示例。 &emsp;&emsp;首先将客户端的调用信息放入一个app. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yanyaner.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="刘江华的博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">刘江华的博客</a></h1>
  
    <h2>众里寻她千百度，蓦然回首，那人却在，灯火阑珊处......</h2>
  
</hgroup>

</header>
  <article class="my_clear"><img src="/images/commons/banner.jpg" class="my_clear"></img></article>
  <nav role="navigation">
  
<ul class="main-navigation">
  <li><a href="/">博客文章</a></li>
  <li><a href="/blog/archives">全部文章</a></li>
  <li><a href="/blog/categories/hui-hua-zuo-pin">我的作品</a></li>
  <li><a href="/about">关于老刘</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/22/security-filter-client-call/">客户端无状态参数调用实现</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-22T15:18:00+08:00" pubdate data-updated="true">2014年07月22日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;我在<a href="/blog/2014/07/20/security-filter-sign/">《服务器端无状态参数验证实现）》</a>中给大家贴出了无状态调用中对数据的验证机制服务器端实现代码，那么，客户端如何去进行调用呢？我同样给大家给出一个客户端调用的登录示例。</p>

<p>&emsp;&emsp;首先将客户端的调用信息放入一个app.properties配置文件中以方便管理维护，内容如下。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>appKey = crm324123123126
</span><span class='line'>appCode = 54dde0994ef4d86cfdf583e6d1384353
</span><span class='line'>callHost = http://www.mywebsite.com/monitorplatform
</span></code></pre></td></tr></table></div></figure>


<p>&emsp;&emsp;客户端登录代码用到了httpClient，实现如下：</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/22/security-filter-client-call/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/20/security-filter-sign/">服务器端无状态参数验证实现</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-20T15:18:00+08:00" pubdate data-updated="true">2014年07月20日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;我在<a href="/blog/2014/04/16/security4/">《Java安全那些事之四（无状态安全认证）》</a>中提到了在无状态安全认证中，对数据签名的验证可以考虑通过AOP或filter的方式专门提取到了一个层中去处理，很多人在问我有没有源代码，现在贴出请大家参考。</p>

<p>&emsp;&emsp;当我们有了这个独立的层次，我们在应用控制器中就不再需求做这方面的检测了，着实方便了许多。</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/20/security-filter-sign/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/19/art-arter/">拜访画家朋友丁老师</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-19T15:18:00+08:00" pubdate data-updated="true">2014年07月19日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;两年前就想去拜访一下丁红卫老师，由于各种原因一直没能实现，前几天在微信朋友圈看到了一篇媒体关于他的报道，才决定一定要去看看他了。</p>

<p>&emsp;&emsp;来到成都东边位于红河的丁老师家，门开了，一个光头长须、黑框眼镜、穿拖鞋、深色花裤的师者出现在眼前，很难道想像眼前这样一个中国传统形象的老师居然在从事着西洋的绘画艺术。于老师的家处处充满着艺术气息，古老的吊扇、泛黄的旧箱子、斑驳的旧木门&hellip;.，桌上是精致的茶具，非常好有艺术氛围。</p>

<p>&emsp;&emsp;寒暄了几句，坐桌边开始了我们的一些讨论，对于艺术而言我就是一个局外人、体制外的人，只不过对绘画有着一种特殊的、难以释怀情节，在这次交谈中，感觉收获很多。努力摆脱传统绘画的结构、型体、透视、色彩束缚，形成自己独立的风格和出路，是丁老师目前正在做的事情。</p>

<p>&emsp;&emsp;下午去了丁老师画室，强烈感觉到作为一位职业画家的创作专注度和专业精神，川美毕业的他已经从事创作近20年，如今小有成就。画室中的5幅即将完成的作品颇具震撼力。</p>

<p>&emsp;&emsp;此行对我影响比较大，今后的我除了工作、生活之外，也将抽出更多的业余时间投入到我的艺术创作中，一方面是潜移默化地影响孩子，更多的是为了自己更加的专注。在此，由衷的祝福丁红卫老师的艺术能够达到更高、更远的境界。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/art1.jpg' width='' height='' title='丁老师早期作品1'><span class='caption-text'>丁老师早期作品1</span></span></p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/art2.jpg' width='' height='' title='丁老师早期作品2'><span class='caption-text'>丁老师早期作品2</span></span></p>

<p>&emsp;&emsp;这两张作品都是灰色调的(成都画家大多数是灰色调，是不是和天气有关啊，呵呵)，画室中的新作品颜色会艳丽些，要等丁老师全部完成后我再拍照。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/18/art-love/">油画-且末.考古现场之一号墓</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-18T15:18:00+08:00" pubdate data-updated="true">2014年07月18日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;100*80CM油画作品。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-1.jpg' width='' height='' title='考古现场之全图'><span class='caption-text'>考古现场之全图</span></span></p>

<p>&emsp;&emsp;局部放大图请大家欣赏，注意细节的笔触哦。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-2.jpg' width='' height='' title='局部放大-左上'><span class='caption-text'>局部放大-左上</span></span></p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-3.jpg' width='' height='' title='局部放大-右上'><span class='caption-text'>局部放大-右上</span></span></p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-4.jpg' width='' height='' title='局部放大-右下'><span class='caption-text'>局部放大-右下</span></span></p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-5.jpg' width='' height='' title='局部放大-左下'><span class='caption-text'>局部放大-左下</span></span></p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/07/love-6.jpg' width='' height='' title='局部放大-落款'><span class='caption-text'>局部放大-落款</span></span></p>

<p>&emsp;&emsp;这张画从构思到完成，断断续续花了两个月的业余时间，不过最终效果是非常不错的。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/16/spring-restful-validator/">Spring Mvc Restful服务器端数据验证实现</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-16T15:18:00+08:00" pubdate data-updated="true">2014年07月16日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;服务器端的数据合法性验证非常有必要而且是必须的，特别是restful api中场景中存在多种类型的客户端，你不能保证每种客户端都已经做好了本地化的数据合法性验证。</p>

<p>&emsp;&emsp;对于业务逻辑来说，我们一般会对新增业务操作以及修改业务操提交上来的数据进行验证，而一般的mvc框架都有对验证功能的封装集成，spring mvc也不利外，但这些集成的验证都和特定的视图标签有密切的联系，比如jsp标签库，而在我所说的restful场景中，服务器上往往不做页面的生成工作，那自然是用到到这些标签了。怎么办呢？只有自己做一些封装和改造了，简单的说，就是我们自己去解析BindingResult中的信息。</p>

<p>&emsp;&emsp;请看我下面封装的通用数据返回类代码，其中sendValidationFaildResponse方法会将验证出来的错误信息返回给客户端：</p>

<figure class='code'><figcaption><span>RespMessage.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.codehaus.jackson.JsonGenerationException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.JsonMappingException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.validation.FieldError</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.my.ms.framework.commons.JsonMapper</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * 向客户端返回的统一消息</span>
</span><span class='line'><span class="cm"> * @author ljh</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RespMessage</span> <span class="o">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">API_PARAM_ERROR</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SUCCESS</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">FAIL</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DATA_VALIDATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//操作状态码  0：操作失败，1：成功， 其它数据，由客户自定义</span>
</span><span class='line'>  <span class="c1">//-1:数据验证失败 ， 其它取值含义由客户自定义</span>
</span><span class='line'>  <span class="c1">//10:api调用出错参数错误（特别是在无状态webservice之类的调用情况下）</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="n">SUCCESS</span><span class="o">;</span>
</span><span class='line'>  <span class="c1">//要返回的消息</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="c1">//返回的数据</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Object</span> <span class="n">data</span><span class="o">;</span>
</span><span class='line'>  <span class="c1">//消息版本，保留待用</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">version</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setData</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sendValidationFaildResponse</span><span class="o">(</span>
</span><span class='line'>          <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
</span><span class='line'>          <span class="n">JsonMapper</span> <span class="n">mapper</span><span class="o">,</span>
</span><span class='line'>          <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">DATA_VALIDATION_ERROR</span><span class="o">;</span>
</span><span class='line'>          <span class="c1">//这里只取字段类型的错误</span>
</span><span class='line'>          <span class="n">List</span><span class="o">&lt;</span><span class="n">FieldError</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">();</span>
</span><span class='line'>          <span class="n">Map</span> <span class="n">error_map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
</span><span class='line'>          <span class="k">for</span> <span class="o">(</span><span class="n">FieldError</span> <span class="n">e</span> <span class="o">:</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">error_map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getField</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">());</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>          <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">error_map</span><span class="o">;</span>
</span><span class='line'>          <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="s">&quot;你提交的数据没有通过验证！&quot;</span><span class="o">;</span>
</span><span class='line'>          
</span><span class='line'>          <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">mapper</span><span class="o">.</span><span class="na">writeValue</span><span class="o">(</span><span class="n">resp</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">(),</span> <span class="k">this</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>          
</span><span class='line'>          <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&emsp;&emsp;接下来再来看看添加数据的action代码，这段代码中首先进行了数据合法性的验证：</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/16/spring-restful-validator/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/15/spring-mvc-test/">Spring Mvc 表现层测试</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-15T15:18:00+08:00" pubdate data-updated="true">2014年07月15日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;表现层、业务层、持久层是一个经典的分层架构，在构建软件系统时，一般会从持久层开始，逐渐向上层编码、构建，每一层完成编码后必须保证正确后，再写上一层，这就像修房子一样，打牢地基再砌墙。</p>

<p>&emsp;&emsp;另外需提一下，一般公司的项目中对持久层都有通用的封装（比如baseDao），因此，持久层的代码在这种情况下就表现为ORM注解或sql语句块，如果是hibernate注解，在项目启动时就可以发现大部分配置上的错误，如果是mybatis或ibatis依旧可以放到业务层中去测试。因此，我认为持久层不用专门去写测试代码了，我们针对业务层的测试即可发现持久层的问题。</p>

<p>&emsp;&emsp;还有，表现层在采用了restful及json数据返回格式后，前端的交互编码其实可以很早就进行，即和后台编码同步进行，我计划有时间去实现一个这样的模拟系统服务器，在设计人员完成rest api设计后，就可以将api输入这个模拟服务器系统，前端程序员依照rest api就可以和模拟服务器交互了，这样前后台就可以分工同步开发了，效率一定会提升哦。</p>

<p>&emsp;&emsp;言归正传，下面我主要来讲讲服务器端的action测试，因为在这个时候，我们还没有任何界面交互，而仅仅只有一个restful api。如何对action进行测试，在早期的spring版本中还比较困难，网上很多同学都是自己封装，但依然不方便不强大。好消息是从spring 3.2开始，提供了对spring mvc完善的支持，请看下面的这个登录action代码及测试。</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/15/spring-mvc-test/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/03/fastDFS-config/">分布式文件系统fastdfs解析之二(配置)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-03T15:18:00+08:00" pubdate data-updated="true">2014年06月03日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;我计划在两台服务器上安装fdfs，ip分别是:192.168.68.133（1号服务器）, 192.168.68.136（2号服务器），fdfs在两台服务器上的安装部署图如下。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/05/fdfs_deploy.jpg' width='' height='' title='fastdfs部署示意图'><span class='caption-text'>fastdfs部署示意图</span></span></p>

<p>&emsp;&emsp;1号服务器上安装tracker实例一个，storage实例2个，分别位于group1,group2两个不同的组中；2号服务器上也安装tracker实例一个，storage实例1个，这个storage和1号服务器中的其中一个storage位于同一个组中。下面给大家贴出具体配置。</p>

<p>&emsp;&emsp;1号服务器中，我们先： vim /usr/local/fastdfs/conf/storage_ids.conf</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># &lt;id&gt;  &lt;group_name&gt;  &lt;ip_or_hostname&gt;
</span><span class='line'>100001   group1  192.168.68.133
</span><span class='line'>100002   group2  192.168.68.133
</span><span class='line'>100003   group1  192.168.68.136</span></code></pre></td></tr></table></div></figure>


<p>&emsp;&emsp;在这个文件中为所有存储服务器指定id, 这样可以免更换ip带来的影响，也就是说当服务器ip发生改变后只需要更改这个文件中的ip地址即可。</p>

<p>&emsp;&emsp;编辑tracker.conf，vim /usr/local/fastdfs/conf/tracker.conf配置文件，以下仅仅列出我改过的或者我认为需要给大家说明的配置项，没有贴出的均保持配置文件中的默认值。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'># the tracker server port
</span><span class='line'>port=22122
</span><span class='line'>
</span><span class='line'># the base path to store data and log files
</span><span class='line'>base_path=/var/fastdfs/tracker
</span><span class='line'>
</span><span class='line'># the method of selecting group to upload files
</span><span class='line'># 0: round robin
</span><span class='line'># 1: specify group
</span><span class='line'># 2: load balance, select the max free space group to upload file
</span><span class='line'>store_lookup=2
</span><span class='line'>
</span><span class='line'># which group to upload file
</span><span class='line'># when store_lookup set to 1, must set store_group to the group name
</span><span class='line'>store_group=group2
</span><span class='line'>
</span><span class='line'>#unix group name to run this program, 
</span><span class='line'>#not set (empty) means run by the group of current user
</span><span class='line'>run_by_group=
</span><span class='line'>
</span><span class='line'>#unix username to run this program,
</span><span class='line'>#not set (empty) means run by current user
</span><span class='line'>run_by_user=
</span><span class='line'>
</span><span class='line'># if use storage ID instead of IP address
</span><span class='line'># default value is false
</span><span class='line'># since V4.00
</span><span class='line'>use_storage_id = true
</span><span class='line'>
</span><span class='line'># the max time of storage sync a file
</span><span class='line'># default value is 300 seconds
</span><span class='line'># since V2.00
</span><span class='line'>storage_sync_file_max_time = 300
</span></code></pre></td></tr></table></div></figure>


<p>&emsp;&emsp;现对上面列出的一些配置项进行解释：</p>

<p>&emsp;&emsp;<strong>port</strong>：tracker服务器的端口号，如果一台服务器上要运行多个tracker实例就需要更改此端口号以避免冲突。</p>

<p>&emsp;&emsp;<strong>base_path</strong>：tracker自身配置信息以及日志信息保存的位置，这个目录本不会占用太大的空间，但日志文件会随着使用而慢慢变大。</p>

<p>&emsp;&emsp;<strong>store_lookup</strong>：负载分配机制，2表示选择存储空间最大的组来保存文件。</p>

<p>&emsp;&emsp;<strong>run_by_group，run_by_user</strong>：指定运行tracker的用户组及用户，这是为了保存系统的安全，我们一般会为fdfs新建组及用户。</p>

<p>&emsp;&emsp;<strong>use_storage_id</strong>：使用存储服务器id替代ip地址，我们刚才编辑的storage_ids.conf中指定了每个实例的id。</p>

<p>&emsp;&emsp;<strong>storage_sync_file_max_time</strong>：同一组中的不同storate进行文件同步的时间，默认是5分钟内完成同步，你可以根据实际情况把这个值改小（改变这个值后可以观察到文件同步的效果，这个值不要设置得太小以避免造成系统同步网络压力）。</p>

<p>&emsp;&emsp;接下来我们配置本台服务器上的storage实例，先配置storage1.conf实例，这个实例位于group1中。</p>

<p>&emsp;&emsp;vim /usr/local/fastdfs/conf/storage1.conf，同样限于篇幅，我仅仅贴出重要配置项，其它的使用默认值。</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/06/03/fastDFS-config/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/30/fastDFS-setup/">分布式文件系统fastdfs解析之一(安装)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-30T15:18:00+08:00" pubdate data-updated="true">2014年05月30日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;fastdfs是一个轻量级的分布式文件系统服务，它在互联网项目中有比较广泛的用途，类似的还有tfs等，但fastdfs和hadoop这些又不相同，hadoop是分布式存储计算框架，比较重量级，而fastdfs针对的是海量的小文件。</p>

<p>&emsp;&emsp;项目中经常会有这样一些应用场景，比如：文件服务器需要存储海量的用户文件并且对外提供用户的访问操作；文件服务器需要高可用性和高性能；文件服务器需要实现负载均衡；文件服务器可实时扩容等等，这些需求在Fastdfs中有实现，因此它可以满足大部的项目需求。</p>

<p>&emsp;&emsp;先给大家简单介绍一下fastdfs的原理，下面这张图有助于大家了解分布式文件系统的原理（hadoop之类的分布式体系与之有相似之处）。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/04/seq_fastdfs.jpg' width='' height='' title='fastdfs调用时序图'><span class='caption-text'>fastdfs调用时序图</span></span></p>

<p>&emsp;&emsp;上面这张图中客户端针对文件服务系统的调用，首先得通过tracker服务器，这个服务器充当了调度者的作用。客户端可以是任何的程序客户端，比如java客户端、php客户端、nginx插件客户端等。</p>

<p>&emsp;&emsp;在客户端调用之前先得启动tracker server，然后再分别启动各个storage server，每个storage server启动后会注册自己的信息到指定的tracker server中（其实，tracker server服务器也可以有多个，从高可用性方面考虑我们一般会启动多个tracker server实例）。</p>

<p>&emsp;&emsp;storage server负责具体文件的存储。storage server按照分组的方式来保存文件的，比如group1,group2等。一个组中可以有多台服务器，同一个组里的所有服务器中保存的文件内容都是相同的，因为同一个组中的服务器之间会相互自动同步文件，这样就实现了冗余备份及负载均衡的功能（负载均衡由tracker server调试的哦）。</p>

<p>&emsp;&emsp;不同组中的storage server之间是独立的，当系统存储容量不够时，通过添加新服务器并分配到新的组中，tracker server发现新的服务器后会自动调度以实现后续客户文件的写入位置。</p>

<p>&emsp;&emsp;上图中，客户通过询问tracker server得到可用的storage server（tracker server会通过负载均衡及各个storage的存储可用容量大小算法决定，当然这个也可以在配置文件中指定），客户端得到storage server后进行相应的文件操作，同组服务器间会根据操作的结果进行文件同步（时序9，10是同步操作）。</p>

<p>&emsp;&emsp;好了，原理先说到这。下面，我将给大家简单介绍FastDfs的安装及使用，以及一些注意事项。</p>

<p>&emsp;&emsp;我的服务器是ubuntu server，我计划安装在两台服务器上，ip分别是:192.168.68.133, 192.168.68.136，暂时简称为1号服务器，2号服务器。</p>

<p>&emsp;&emsp;一号服务器上，将安装一个tracker server实例，一个位于group1中的storage server实例，一个位于group2中storage server实例。</p>

<p>&emsp;&emsp;二号服务器上，也将安装一个tracker server实例，一个位于group1中的storage server实例。需要大家注意的是，fastdfs中一台服务器上可以安装多个组，但一个组中的多个storade server必须安装在不同的服务器上，并且同组中的storage server的服务端口必须一致，否则无法实现文件同步。</p>

<p>&emsp;&emsp;我先在一号服务器192.168.68.133上安装fastdfs。首先要准备安装环境，不同的linux发行版本可能会有所不同，我用的服务器版本是ubuntu 12.04 server，以下的操作均以这个版本的ubuntu服务器为例。</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/05/30/fastDFS-setup/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/29/code-share-poi/">分享几段数据导入导出参考代码</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-29T15:18:00+08:00" pubdate data-updated="true">2014年05月29日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;给童鞋写的几段参考demo代码，有需要的可以参考一下哦：</p>

<ol>
<li><p>poi excel数据导入（导入数据是考虑该数据已经存在的情况，如果存在则进行更新操作）</p></li>
<li><p>zip照片包导入（照片的导入会更新已经存在的照片并且会按业务规则建立照片目录分类存放）</p></li>
<li><p>按模板导格式导出数据至excel中（excel导出需要提供一个excel文件模板，将数据直接写到模板中，这样才能更好地符合用户的实际业务场景）</p></li>
</ol>


<p>&emsp;&emsp;下面这demo写得非常简单，并没有考虑导入出错时给予调用者出错的细节信息，这些代码大家都可以继续完善。另外你也可以将表和excel的字段对应关系保存在数据库中，让用户通过界面自由定义指定映射关系（当然这需要更深层次的封装，这个代码我以后贴出来）。</p>

<p>&emsp;&emsp;业务接口核心方法共3个，大家可以参考这种设计以简化调用者的复杂性：</p>

<figure class='code'><figcaption><span>ISystemService.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * demo系统业务接口</span>
</span><span class='line'><span class="cm"> * @author ljh</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ISystemService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">importStudents</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">excelIs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">classesId</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">importStudentPhotos</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">zipFileByte</span><span class="o">,</span> <span class="n">String</span> <span class="n">uploadDir</span><span class="o">,</span> <span class="kt">int</span> <span class="n">classesId</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exportStudents</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span> <span class="o">,</span> <span class="n">InputStream</span> <span class="n">templateFile</span><span class="o">,</span> <span class="n">OutputStream</span> <span class="n">outputFile</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&emsp;&emsp;业务实现类代码如下：</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/05/29/code-share-poi/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/23/security6/">Java安全那些事之六（客户端安全）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-23T15:18:00+08:00" pubdate data-updated="true">2014年05月23日</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&emsp;&emsp;这篇文章我想说一下客户端保存密码的安全性问题。目前在客户端保存用户登录密码的场景非常的普遍，尤其是在手机客户端应用中更为常见。下图是一个浏览器端中设计的保存密码界面。</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/05/auto_login.jpg' width='' height='' title='保存密码及自动登录界面'><span class='caption-text'>保存密码及自动登录界面</span></span></p>

<p>&emsp;&emsp;图中，用户可以选择保存自己的用户名和密码，如果用户选择了这一项，密码当然是保存在客户端的哦（浏览器中就是cookie）。在保存了上次登录密码的情况下客户端再次进行手动或自动登录时，客户端将取出自动保存的密码提交到服务器。</p>

<p>&emsp;&emsp;我们可以想像到，如果将密码以明文的方式保存到客户端显然是不可取的。对密码进行加密处理后再保存客户端是一个可行的做法，但对密码加密的算法就值得我们去选择，base64肯定是不行的了，DES、RSA都是可以选择的加密方法，因为这些算法是可还原的算法，也就是说服务器收到加密密码后须还原成明文，再执行后续的登录业务。</p>

<p>&emsp;&emsp;交互示意图如下：</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/05/seq_auto_login.jpg' width='' height='' title='保存密码登录处理时序'><span class='caption-text'>保存密码登录处理时序</span></span></p>

<p>&emsp;&emsp;简单地给大家解释一下上图中的流程：</p>

<p>&emsp;&emsp;客户端在第一次登录时，如果选择了记录用户名和密码，在第一次登录成功后系统将返回经过加密处理的密码，客户端在得加密密码后进行本地保存（时序2.1为客户端保存服务器端返回的经过加密处理的密码）。</p>

<p>&emsp;&emsp;客户端在第二次登录时提交的是曾经保存的加密密码，服务器得到密码后检测出来是经过加密处理的密码（时序3.1的处理）。</p>

<p>&emsp;&emsp;服务器端进行安全检测（比如本次登录ip和上次不同等方法），如果检测没有通过就进行异常处理，比如返回图片验证码让用户输入或要求用户重新输入密码等（时序3.2即是这个处理）。</p>

<p>&emsp;&emsp;安全检测通过后，系统将解密还原加密的密码（时序3.3的处理），这个过程可能会用到密钥，如果采用的是RSA加密算法，这时可从数据库中取出模和指数生成私钥，以便进行解密处理。</p>

<p>&emsp;&emsp;解密成功后，即可调用正常登录业务逻辑（时序3.4）。</p>

<p>&emsp;&emsp;下图是在浏览器cookies中保存了加密密码的界面截图：</p>

<p><span class='caption-wrapper'><img class='caption' src='/uploads/2014/05/auto_login_cookies.jpg' width='' height='' title='cookies中的内容'><span class='caption-text'>cookies中的内容</span></span></p>

<p>&emsp;&emsp;不多说了，下面给出演示代码，我用的是RSA密码加密算法。首先贴出登录的html代码:</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/05/23/security6/">阅读全文☺→♥</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; 更多早期老文章</a>
    
    <a href="/blog/archives">所有文章</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>最近文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/22/security-filter-client-call/">客户端无状态参数调用实现</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/20/security-filter-sign/">服务器端无状态参数验证实现</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/19/art-arter/">拜访画家朋友丁老师</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/18/art-love/">油画-且末.考古现场之一号墓</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/16/spring-restful-validator/">Spring Mvc Restful服务器端数据验证实现</a>
      </li>
    
  </ul>
</section>
<section>
   <h1>文章分类</h1>
   <ul id="categories">
     
		<li><a href="/blog/categories/sheng-huo">生活</a><a href="/blog/categories/yi-zhu">艺术</a></li>
		<li><a href="/blog/categories/ji-zhu">技术</a><a href="/blog/categories/jia-gou">架构</a></li>
		<li><a href="/blog/categories/java">java</a><a href="/blog/categories/javaee">javaEE</a></li>
		<li><a href="/blog/categories/qian-duan-ji-zhu">前端技术</a><a href="/blog/categories/nodejs">Node.js</a></li>
	    <li><a href="/blog/categories/bu-zou-jie-xi">步骤解析</a></li>
	 
   </ul>
</section>

<section>
  <h3></h3>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6635992117744268"
     data-ad-slot="8027050961"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</section>

<section>
<h1>最近评论</h1>
<ul class="ds-recent-comments" data-num-items="10">
</ul>
<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ljh2008"};
(function() {
var ds = document.createElement('script');
ds.type = 'text/javascript';
ds.async = true;ds.src = 'http://static.duoshuo.com/embed.js';
ds.charset = 'UTF-8';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!--多说js加载结束，一个页面只需要加载一次 -->
</section><section>
<h1>最近来访</h1>
<ul class="ds-recent-visitors" data-num-items="60">
</ul>
<script type="text/javascript">
var duoshuoQuery = {short_name:"ljh2008"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  版权所有 &copy; 2014 - 冰雨 -
  <span class="credit">Powered by <a href="http://yanyaner.com">刘江华的博客</a></span>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5742334'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5742334%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  











</body>
</html>
